import multiprocessing
import subprocess
import os

dataset = [
'gs250a-1_gurobi_SLPR',
'gs250a-1_cplex_SLPR',
'gs250a-1_gurobi_WIP',
'gs250a-1_cplex_WIP',
'gs250a-1_gurobi_ILP',
'gs250a-1_cplex_ILP',
'gs250a-2_gurobi_SLPR',
'gs250a-2_cplex_SLPR',
'gs250a-2_gurobi_WIP',
'gs250a-2_cplex_WIP',
'gs250a-2_gurobi_ILP',
'gs250a-2_cplex_ILP',
'gs250a-3_gurobi_SLPR',
'gs250a-3_cplex_SLPR',
'gs250a-3_gurobi_WIP',
'gs250a-3_cplex_WIP',
'gs250a-3_gurobi_ILP',
'gs250a-3_cplex_ILP',
'gs250a-4_gurobi_SLPR',
'gs250a-4_cplex_SLPR',
'gs250a-4_gurobi_WIP',
'gs250a-4_cplex_WIP',
'gs250a-4_gurobi_ILP',
'gs250a-4_cplex_ILP',
'gs250a-5_gurobi_SLPR',
'gs250a-5_cplex_SLPR',
'gs250a-5_gurobi_WIP',
'gs250a-5_cplex_WIP',
'gs250a-5_gurobi_ILP',
'gs250a-5_cplex_ILP',
'gs250b-1_gurobi_SLPR',
'gs250b-1_cplex_SLPR',
'gs250b-1_gurobi_WIP',
'gs250b-1_cplex_WIP',
'gs250b-1_gurobi_ILP',
'gs250b-1_cplex_ILP',
'gs250b-2_gurobi_SLPR',
'gs250b-2_cplex_SLPR',
'gs250b-2_gurobi_WIP',
'gs250b-2_cplex_WIP',
'gs250b-2_gurobi_ILP',
'gs250b-2_cplex_ILP',
'gs250b-3_gurobi_SLPR',
'gs250b-3_cplex_SLPR',
'gs250b-3_gurobi_WIP',
'gs250b-3_cplex_WIP',
'gs250b-3_gurobi_ILP',
'gs250b-3_cplex_ILP',
'gs250b-4_gurobi_SLPR',
'gs250b-4_cplex_SLPR',
'gs250b-4_gurobi_WIP',
'gs250b-4_cplex_WIP',
'gs250b-4_gurobi_ILP',
'gs250b-4_cplex_ILP',
'gs250b-5_gurobi_SLPR',
'gs250b-5_cplex_SLPR',
'gs250b-5_gurobi_WIP',
'gs250b-5_cplex_WIP',
'gs250b-5_gurobi_ILP',
'gs250b-5_cplex_ILP',
'gs250c-1_gurobi_SLPR',
'gs250c-1_cplex_SLPR',
'gs250c-1_gurobi_WIP',
'gs250c-1_cplex_WIP',
'gs250c-1_gurobi_ILP',
'gs250c-1_cplex_ILP',
'gs250c-2_gurobi_SLPR',
'gs250c-2_cplex_SLPR',
'gs250c-2_gurobi_WIP',
'gs250c-2_cplex_WIP',
'gs250c-2_gurobi_ILP',
'gs250c-2_cplex_ILP',
'gs250c-3_gurobi_SLPR',
'gs250c-3_cplex_SLPR',
'gs250c-3_gurobi_WIP',
'gs250c-3_cplex_WIP',
'gs250c-3_gurobi_ILP',
'gs250c-3_cplex_ILP',
'gs250c-4_gurobi_SLPR',
'gs250c-4_cplex_SLPR',
'gs250c-4_gurobi_WIP',
'gs250c-4_cplex_WIP',
'gs250c-4_gurobi_ILP',
'gs250c-4_cplex_ILP',
'gs250c-5_gurobi_SLPR',
'gs250c-5_cplex_SLPR',
'gs250c-5_gurobi_WIP',
'gs250c-5_cplex_WIP',
'gs250c-5_gurobi_ILP',
'gs250c-5_cplex_ILP',
'gs750a-1_gurobi_SLPR',
'gs750a-1_cplex_SLPR',
'gs750a-1_gurobi_WIP',
'gs750a-1_cplex_WIP',
'gs750a-1_gurobi_ILP',
'gs750a-1_cplex_ILP',
'gs750a-2_gurobi_SLPR',
'gs750a-2_cplex_SLPR',
'gs750a-2_gurobi_WIP',
'gs750a-2_cplex_WIP',
'gs750a-2_gurobi_ILP',
'gs750a-2_cplex_ILP',
'gs750a-3_gurobi_SLPR',
'gs750a-3_cplex_SLPR',
'gs750a-3_gurobi_WIP',
'gs750a-3_cplex_WIP',
'gs750a-3_gurobi_ILP',
'gs750a-3_cplex_ILP',
'gs750a-4_gurobi_SLPR',
'gs750a-4_cplex_SLPR',
'gs750a-4_gurobi_WIP',
'gs750a-4_cplex_WIP',
'gs750a-4_gurobi_ILP',
'gs750a-4_cplex_ILP',
'gs750a-5_gurobi_SLPR',
'gs750a-5_cplex_SLPR',
'gs750a-5_gurobi_WIP',
'gs750a-5_cplex_WIP',
'gs750a-5_gurobi_ILP',
'gs750a-5_cplex_ILP',
'gs750b-1_gurobi_SLPR',
'gs750b-1_cplex_SLPR',
'gs750b-1_gurobi_WIP',
'gs750b-1_cplex_WIP',
'gs750b-1_gurobi_ILP',
'gs750b-1_cplex_ILP',
'gs750b-2_gurobi_SLPR',
'gs750b-2_cplex_SLPR',
'gs750b-2_gurobi_WIP',
'gs750b-2_cplex_WIP',
'gs750b-2_gurobi_ILP',
'gs750b-2_cplex_ILP',
'gs750b-3_gurobi_SLPR',
'gs750b-3_cplex_SLPR',
'gs750b-3_gurobi_WIP',
'gs750b-3_cplex_WIP',
'gs750b-3_gurobi_ILP',
'gs750b-3_cplex_ILP',
'gs750b-4_gurobi_SLPR',
'gs750b-4_cplex_SLPR',
'gs750b-4_gurobi_WIP',
'gs750b-4_cplex_WIP',
'gs750b-4_gurobi_ILP',
'gs750b-4_cplex_ILP',
'gs750b-5_gurobi_SLPR',
'gs750b-5_cplex_SLPR',
'gs750b-5_gurobi_WIP',
'gs750b-5_cplex_WIP',
'gs750b-5_gurobi_ILP',
'gs750b-5_cplex_ILP',
'gs750c-1_gurobi_SLPR',
'gs750c-1_cplex_SLPR',
'gs750c-1_gurobi_WIP',
'gs750c-1_cplex_WIP',
'gs750c-1_gurobi_ILP',
'gs750c-1_cplex_ILP',
'gs750c-2_gurobi_SLPR',
'gs750c-2_cplex_SLPR',
'gs750c-2_gurobi_WIP',
'gs750c-2_cplex_WIP',
'gs750c-2_gurobi_ILP',
'gs750c-2_cplex_ILP',
'gs750c-3_gurobi_SLPR',
'gs750c-3_cplex_SLPR',
'gs750c-3_gurobi_WIP',
'gs750c-3_cplex_WIP',
'gs750c-3_gurobi_ILP',
'gs750c-3_cplex_ILP',
'gs750c-4_gurobi_SLPR',
'gs750c-4_cplex_SLPR',
'gs750c-4_gurobi_WIP',
'gs750c-4_cplex_WIP',
'gs750c-4_gurobi_ILP',
'gs750c-4_cplex_ILP',
'gs750c-5_gurobi_SLPR',
'gs750c-5_cplex_SLPR',
'gs750c-5_gurobi_WIP',
'gs750c-5_cplex_WIP',
'gs750c-5_gurobi_ILP',
'gs750c-5_cplex_ILP',
'gs500a-1_gurobi_SLPR',
'gs500a-1_cplex_SLPR',
'gs500a-1_gurobi_WIP',
'gs500a-1_cplex_WIP',
'gs500a-1_gurobi_ILP',
'gs500a-1_cplex_ILP',
'gs500a-2_gurobi_SLPR',
'gs500a-2_cplex_SLPR',
'gs500a-2_gurobi_WIP',
'gs500a-2_cplex_WIP',
'gs500a-2_gurobi_ILP',
'gs500a-2_cplex_ILP',
'gs500a-3_gurobi_SLPR',
'gs500a-3_cplex_SLPR',
'gs500a-3_gurobi_WIP',
'gs500a-3_cplex_WIP',
'gs500a-3_gurobi_ILP',
'gs500a-3_cplex_ILP',
'gs500a-4_gurobi_SLPR',
'gs500a-4_cplex_SLPR',
'gs500a-4_gurobi_WIP',
'gs500a-4_cplex_WIP',
'gs500a-4_gurobi_ILP',
'gs500a-4_cplex_ILP',
'gs500a-5_gurobi_SLPR',
'gs500a-5_cplex_SLPR',
'gs500a-5_gurobi_WIP',
'gs500a-5_cplex_WIP',
'gs500a-5_gurobi_ILP',
'gs500a-5_cplex_ILP',
'gs500b-1_gurobi_SLPR',
'gs500b-1_cplex_SLPR',
'gs500b-1_gurobi_WIP',
'gs500b-1_cplex_WIP',
'gs500b-1_gurobi_ILP',
'gs500b-1_cplex_ILP',
'gs500b-2_gurobi_SLPR',
'gs500b-2_cplex_SLPR',
'gs500b-2_gurobi_WIP',
'gs500b-2_cplex_WIP',
'gs500b-2_gurobi_ILP',
'gs500b-2_cplex_ILP',
'gs500b-3_gurobi_SLPR',
'gs500b-3_cplex_SLPR',
'gs500b-3_gurobi_WIP',
'gs500b-3_cplex_WIP',
'gs500b-3_gurobi_ILP',
'gs500b-3_cplex_ILP',
'gs500b-4_gurobi_SLPR',
'gs500b-4_cplex_SLPR',
'gs500b-4_gurobi_WIP',
'gs500b-4_cplex_WIP',
'gs500b-4_gurobi_ILP',
'gs500b-4_cplex_ILP',
'gs500b-5_gurobi_SLPR',
'gs500b-5_cplex_SLPR',
'gs500b-5_gurobi_WIP',
'gs500b-5_cplex_WIP',
'gs500b-5_gurobi_ILP',
'gs500b-5_cplex_ILP',
'gs500c-1_gurobi_SLPR',
'gs500c-1_cplex_SLPR',
'gs500c-1_gurobi_WIP',
'gs500c-1_cplex_WIP',
'gs500c-1_gurobi_ILP',
'gs500c-1_cplex_ILP',
'gs500c-2_gurobi_SLPR',
'gs500c-2_cplex_SLPR',
'gs500c-2_gurobi_WIP',
'gs500c-2_cplex_WIP',
'gs500c-2_gurobi_ILP',
'gs500c-2_cplex_ILP',
'gs500c-3_gurobi_SLPR',
'gs500c-3_cplex_SLPR',
'gs500c-3_gurobi_WIP',
'gs500c-3_cplex_WIP',
'gs500c-3_gurobi_ILP',
'gs500c-3_cplex_ILP',
'gs500c-4_gurobi_SLPR',
'gs500c-4_cplex_SLPR',
'gs500c-4_gurobi_WIP',
'gs500c-4_cplex_WIP',
'gs500c-4_gurobi_ILP',
'gs500c-4_cplex_ILP',
'gs500c-5_gurobi_SLPR',
'gs500c-5_cplex_SLPR',
'gs500c-5_gurobi_WIP',
'gs500c-5_cplex_WIP',
'gs500c-5_gurobi_ILP',
'gs500c-5_cplex_ILP',
]

# ["docker","run","-it","-v","/ampl_results:/ampl_results","ormno_ampl","./ampl"] gs250a-1_gurobi_SLPR.sa1
def ampl_optimize(data):
    if os.path.exists('/ampl_results/'+data+'.done'):
        print('Skip', data)
        return True
    try:
        print('Solving', data)
        subprocess.run(['./ampl',data+".sa1"], check=True)
    except subprocess.CalledProcessError as err:
        print('Failed', data)
        return False
    else:
        print('Complite', data)
        with open('/ampl_results/'+data+'.done', 'w') as file:
            file.write(data)
        return True


if __name__ == '__main__':

    pool = multiprocessing.Pool(4)
    results = pool.map(ampl_optimize, dataset)
    print(zip(dataset,results))
